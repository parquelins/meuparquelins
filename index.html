<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Condom√≠nio Parque Lins de Vasconcelos</title>
  <style>
    :root{
      --verde-escuro:#1B3A2D;
      --verde-medio:#2E6B4F;
      --verde-claro:#A3D9B1;
      --branco:#fff;
      --bg:#F9FAFB;
      --texto:#1F2937;
    }
    *{box-sizing:border-box;margin:0;padding:0}
    html {scroll-behavior:smooth;}
    body{
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      background:var(--bg);
      color:var(--texto);
      line-height:1.5;
    }
    header{background:var(--branco);box-shadow:0 4px 12px rgba(0,0,0,0.06);z-index:999;}
    .header-content{max-width:1200px;margin:0 auto;padding:12px 20px;display:flex;align-items:center;justify-content:space-between;gap:12px;}
    .logo-row{display:flex;align-items:center;gap:16px;}
    .logo-row img{height:78px;width:auto;border-radius:10px;transition:transform .2s;box-shadow:0 6px 16px rgba(0,0,0,0.12);}
    .logo-row h1{font-size:1.8rem;color:var(--verde-escuro);font-weight:800;letter-spacing:0.01em;}
    .nav {display:flex;align-items:center;gap:12px;}
    .nav ul{display:flex;gap:18px;list-style:none;align-items:center;}
    .nav a{text-decoration:none;color:var(--verde-escuro);font-weight:700;padding:10px 16px;border-radius:10px;transition:background .18s, color .18s;}
    .nav a:hover{background:rgba(46,107,79,0.08)}
    .nav-toggle{display:none;background:transparent;border:0;cursor:pointer;width:44px;height:44px;}
    .nav-toggle .bar{display:block;height:3px;background:var(--verde-escuro);margin:6px 0;border-radius:3px;transition:transform .2s,opacity .2s;}
    .hero{max-width:1200px;margin:20px auto;padding:36px;border-radius:12px;color:var(--branco);background:linear-gradient(135deg,var(--verde-medio) 0%,var(--verde-claro) 100%);box-shadow:0 10px 30px rgba(0,0,0,0.12);}
    .hero h2{font-size:2.6rem;margin-bottom:12px;text-shadow:2px 2px 8px rgba(0,0,0,0.18);}
    .hero p{font-size:1.05rem;max-width:920px;margin:0 auto;font-weight:600}
    main{max-width:1200px;margin:16px auto;padding:0 20px 60px}
    section{background:var(--branco);margin-bottom:18px;padding:18px;border-radius:10px;box-shadow:0 6px 18px rgba(0,0,0,0.06);}
    section h2{color:var(--verde-escuro);font-size:1.5rem;margin-bottom:8px;font-weight:800;display:flex;align-items:center;gap:12px;}
    .cards{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:14px;margin-top:12px;}
    .card{background:#FAFCFB;padding:14px;border-radius:10px;border-left:6px solid var(--verde-medio);}
    .card h3{margin-bottom:6px;color:var(--verde-escuro);font-size:1.05rem}
    .card .date{color:var(--verde-medio);font-weight:700;font-size:.95rem}
    .contact-form{max-width:600px;margin:0 auto}
    .form-group{margin-bottom:12px}
    label{display:block;margin-bottom:6px;font-weight:700;color:var(--verde-escuro)}
    input,textarea{width:100%;padding:10px;border:1px solid #E4E7EB;border-radius:8px;font-size:1rem}
    .btn{background:var(--verde-medio);color:var(--branco);padding:10px 18px;border-radius:10px;border:0;font-weight:800;cursor:pointer}
    .btn-small{padding:6px 10px;font-size:0.9rem;border-radius:8px}
    footer{background:var(--verde-escuro);color:var(--branco);text-align:center;padding:20px;font-weight:600;margin-top:20px;border-radius:6px}
    @media (max-width: 880px){.logo-row img{height:64px}.logo-row h1{font-size:1.2rem}.hero{padding:24px}.hero h2{font-size:1.6rem}.hero p{font-size:0.98rem}.nav ul{display:none}.nav-toggle{display:block}header{position:static}}
    .nav.open ul{display:block;position:absolute;right:20px;top:84px;background:var(--branco);border-radius:10px;padding:8px;box-shadow:0 10px 30px rgba(0,0,0,0.12);min-width:180px;}
    @media (min-width:881px){html {scroll-padding-top:120px;}header{position:sticky; top:0;}}
    .modal-body { max-height: 70vh; overflow:auto; margin-top:8px; padding-right:8px; }
  </style>
</head>
<body>
  <header>
    <div class="header-content">
      <div class="logo-row">
        <img src="https://cdn.abacus.ai/images/ca8ad4ba-c6b4-45a6-b78e-fafb406f6229.png" alt="Logo Condom√≠nio">
        <h1>Condom√≠nio Parque Lins de Vasconcelos</h1>
      </div>

      <nav class="nav" id="site-nav">
        <button class="nav-toggle" id="navToggle" aria-label="Abrir menu">
          <span class="bar"></span><span class="bar"></span><span class="bar"></span>
        </button>
        <ul>
          <li><a href="#inicio">In√≠cio</a></li>
          <li><a href="#avisos">Avisos</a></li>
          <li><a href="#bazar">Bazar</a></li>
          <li><a href="#prestadores">Prestadores</a></li>
          <li><a href="#eventos">Eventos</a></li>
          <li><a href="#regras">Regras</a></li>
          <li><a href="#contato">Contato</a></li>
        </ul>
      </nav>
    </div>
  </header>

  <main>
    <section id="inicio" class="hero" aria-labelledby="titulo-hero">
      <h2 id="titulo-hero">Bem-vindo ao Portal do Condom√≠nio</h2>
      <p>Seu espa√ßo de comunica√ß√£o, informa√ß√£o e conviv√™ncia. Aqui voc√™ encontra avisos importantes, eventos, servi√ßos e muito mais!</p>
    </section>

    <section id="avisos" data-content-path="content/avisos">
      <h2>üì¢ Avisos e Comunicados</h2>
      <div class="cards"><p>Carregando...</p></div>
    </section>

    <section id="bazar" data-content-path="content/bazar">
      <h2>üõçÔ∏è Bazar e Doa√ß√µes</h2>
      <div class="cards"><p>Carregando...</p></div>
    </section>

    <section id="prestadores" data-content-path="content/prestadores">
      <h2>üîß Prestadores de Servi√ßo</h2>
      <div class="cards"><p>Carregando...</p></div>
    </section>

    <section id="eventos" data-content-path="content/eventos">
      <h2>üéâ Eventos</h2>
      <div class="cards"><p>Carregando...</p></div>
    </section>

    <section id="regras" data-content-path="content/regras">
      <h2>üìã Regras do Condom√≠nio</h2>
      <div class="cards"><p>Carregando...</p></div>
    </section>

    <section id="contato" data-content-path="content/contato">
      <h2>üìû Contato e S√≠ndico</h2>
      <div class="cards"><p>Carregando...</p></div>
    </section>
  </main>

  <footer>
    <p><strong>Condom√≠nio Residencial Parque Lins de Vasconcelos</strong></p>
    <p>¬© 2025 - Todos os direitos reservados</p>
  </footer>

  <!-- marked para markdown -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

  <script>
    // Ajuste aqui se mudar de repo
    const OWNER = 'parquelins';
    const REPO  = 'meuparquelins';
    const BRANCH = 'main';

    function escapeRegExp(s) { return s.replace(/[.*+?^${}()|[\\\]\\]/g, '\\$&'); }

   // Substitua a fun√ß√£o parseFrontmatter existente por esta:
function parseFrontmatter(md) {
  const fmRegex = /^---\n([\s\S]*?)\n---\n([\s\S]*)$/;
  const m = md.match(fmRegex);
  if (!m) return { data: {}, body: md };

  const lines = m[1].split(/\r?\n/);
  const data = {};
  let currentKey = null;

  for (let raw of lines) {
    // Mantemos a indenta√ß√£o original para detectar itens de lista (come√ßam com "-")
    const trimmed = raw.trim();

    // corresponde a "chave: valor" (pode haver valor vazio => lista a seguir)
    const kv = raw.match(/^\s*([A-Za-z0-9_\-]+)\s*:\s*(.*)$/);
    // corresponde a "- valor" (item de lista)
    const li = raw.match(/^\s*-\s+(.*)$/);

    if (kv) {
      const key = kv[1].trim();
      let val = kv[2] !== undefined ? kv[2].trim() : '';

      // Remove aspas envolventes se existirem
      if (val.startsWith('"') && val.endsWith('"')) val = val.slice(1, -1);
      if (val.startsWith("'") && val.endsWith("'")) val = val.slice(1, -1);

      if (val === '') {
        // chave sem valor: assume-se que vem uma lista a seguir
        data[key] = [];
        currentKey = key;
      } else {
        // se valor cont√©m v√≠rgula e n√£o √© um array YAML, transforma em array simples
        if (val.indexOf(',') !== -1) {
          data[key] = val.split(',').map(s => s.trim());
        } else {
          data[key] = val;
        }
        currentKey = null;
      }
    } else if (li && currentKey) {
      // item de lista ‚Äî adiciona ao array da chave corrente
      let item = li[1].trim();
      if (item.startsWith('"') && item.endsWith('"')) item = item.slice(1, -1);
      if (item.startsWith("'") && item.endsWith("'")) item = item.slice(1, -1);
      data[currentKey].push(item);
    } else {
      // linha que n√£o √© reconhecida (ignorar)
      currentKey = null;
    }
  }

  return { data, body: m[2] };
}

    // render media (images in frontmatter or /uploads/..., videos youtube/vimeo/mp4)
    function renderMedia(front) {
      let html = '';

      // imagens frontmatter (image ou images)
      const imgsField = front.data && (front.data.image || front.data.images) ? (front.data.image || front.data.images) : null;
      const imgs = imgsField ? (Array.isArray(imgsField) ? imgsField : [imgsField]) : [];
      imgs.forEach(src => {
        if (!src) return;
        html += `<img src="${src}" alt="" style="max-width:100%;margin-bottom:10px;border-radius:8px;box-shadow:0 6px 18px rgba(0,0,0,0.06);" />`;
      });

      // imagens detectadas no corpo (refer√™ncias a /uploads/...)
      const bodyImgs = (front.body.match(/\/uploads\/[^\s)"]+/g) || []);
      bodyImgs.forEach(m => {
        html += `<img src="${m}" style="max-width:100%;margin-bottom:10px;border-radius:8px;" />`;
      });

      // v√≠deos: aceita video, video_url ou videos
      const videosField = front.data && (front.data.video || front.data.video_url || front.data.videos) ? (front.data.video || front.data.video_url || front.data.videos) : null;
      const videos = videosField ? (Array.isArray(videosField) ? videosField : [videosField]) : [];
      videos.forEach(videoUrl => {
        if (!videoUrl) return;
        let yt = videoUrl.match(/(?:youtube\.com\/watch\?v=|youtu\.be\/)([A-Za-z0-9_-]+)/);
        if (yt && yt[1]) {
          html += `<div style="margin-top:12px"><iframe src="https://www.youtube.com/embed/${yt[1]}" style="width:100%;max-width:900px;height:400px;border-radius:8px;" frameborder="0" allowfullscreen></iframe></div>`;
        } else {
          let vm = videoUrl.match(/vimeo\.com\/(\d+)/);
          if (vm && vm[1]) {
            html += `<div style="margin-top:12px"><iframe src="https://player.vimeo.com/video/${vm[1]}" style="width:100%;max-width:900px;height:400px;border-radius:8px;" frameborder="0" allowfullscreen></iframe></div>`;
          } else {
            // assume arquivo direto (mp4)
            html += `
              <div style="margin-top:12px;max-width:900px;">
                <video controls preload="none" style="width:100%;height:auto;background:#000;border-radius:6px;">
                  <source src="${videoUrl}" type="video/mp4">
                  Seu navegador n√£o suporta v√≠deo.
                </video>
              </div>`;
          }
        }
      });

      return html;
    }

    // lista arquivos markdown numa pasta (usa GitHub API p√∫blica)
    async function listaConteudo(contentPath) {
      const api = `https://api.github.com/repos/${OWNER}/${REPO}/contents/${contentPath}?ref=${BRANCH}`;
      const res = await fetch(api);
      if (!res.ok) return [];
      const data = await res.json();
      return data.filter(item => item.name && item.name.endsWith('.md')).sort((a,b) => b.name.localeCompare(a.name));
    }

    // carrega se√ß√£o gen√©rica
    async function carregarSecao(contentPath, containerSelector) {
      const container = document.querySelector(containerSelector);
      if (!container) return;
      container.innerHTML = '<p>Carregando...</p>';
      try {
        const files = await listaConteudo(contentPath);
        if (!files.length) { container.innerHTML = '<p>Nenhum item encontrado.</p>'; return; }
        container.innerHTML = '';
        for (const file of files) {
          const mdText = await (await fetch(file.download_url)).text();
          const parsed = parseFrontmatter(mdText);
          const title = parsed.data.title || file.name.replace('.md','');
          const date = parsed.data.date || '';
          const summary = parsed.data.summary || (parsed.body.substring(0,160) + '...');
          const card = document.createElement('div');
          card.className = 'card';
          card.innerHTML = `<span class="date">${date}</span><h3>${title}</h3><p>${summary}</p>
            <p style="margin-top:8px"><a href="#" data-file="${file.download_url}" class="btn btn-small">Ver</a></p>`;
          container.appendChild(card);
        }

        // listener para cada "Ver"
        container.querySelectorAll('a[data-file]').forEach(a => {
          a.addEventListener('click', async (e) => {
            e.preventDefault();
            const dl = e.currentTarget.getAttribute('data-file');
            const md = await (await fetch(dl)).text();
            const parsed = parseFrontmatter(md);

            // limpar men√ß√µes diretas ao video no texto (evita duplicar)
            const videoUrl = parsed.data && (parsed.data.video || parsed.data.video_url) ? (parsed.data.video || parsed.data.video_url).trim() : '';
            const filename = videoUrl ? videoUrl.split('/').pop() : '';
            if (videoUrl && parsed.body) {
              parsed.body = parsed.body.replace(new RegExp(escapeRegExp(videoUrl), 'g'), '');
              if (filename) parsed.body = parsed.body.replace(new RegExp(escapeRegExp(filename), 'g'), '');
              parsed.body = parsed.body.replace(new RegExp('\\[[^\\]]*\\]\\(\\s*' + escapeRegExp(videoUrl) + '\\s*\\)', 'gi'), '');
              if (filename) parsed.body = parsed.body.replace(new RegExp('\\[[^\\]]*\\]\\([^)]*' + escapeRegExp(filename) + '[^)]*\\)', 'gi'), '');
            }

            let html = marked.parse(parsed.body || '');
            html = html.replace(/<video[\s\S]*?<\/video>/gi, '');
            html = html.replace(/<iframe[\s\S]*?<\/iframe>/gi, '');

            const modal = document.createElement('div');
            modal.style = 'position:fixed;left:0;top:0;width:100%;height:100%;overflow:auto;background:rgba(0,0,0,0.6);padding:30px;z-index:9999;';
            modal.innerHTML = `<div style="max-width:900px;margin:0 auto;background:#fff;padding:22px;border-radius:10px;position:relative;">
              <button id="fechar" style="position:absolute;right:14px;top:14px;padding:8px 12px;border-radius:8px;border:0;cursor:pointer;">Fechar</button>
              <h2 style="color:#1B3A2D">${parsed.data.title || ''}</h2>
              <p style="color:#2E6B4F;font-weight:700">${parsed.data.date || ''}</p>
              <div class="modal-body" style="margin-top:12px">${renderMedia(parsed)}${html}</div>
            </div>`;
            document.body.appendChild(modal);
            modal.querySelector('#fechar').addEventListener('click', () => modal.remove());
          });
        });

      } catch (err) {
        console.error(err);
        container.innerHTML = '<p>Erro ao carregar items.</p>';
      }
    }

    document.addEventListener('DOMContentLoaded', () => {
      // carregar todas as sections com data-content-path
      document.querySelectorAll('section[data-content-path]').forEach(sec => {
        const path = sec.getAttribute('data-content-path');
        const containerSelector = `#${sec.id} .cards`;
        carregarSecao(path, containerSelector);
      });

      // mobile nav
      const nav = document.getElementById('site-nav');
      const toggle = document.getElementById('navToggle');
      toggle && toggle.addEventListener('click', () => nav.classList.toggle('open'));
      document.querySelectorAll('.nav ul a').forEach(a => a.addEventListener('click', () => nav.classList.remove('open')));
    });
  </script>
</body>
</html>
