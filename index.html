<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Condom√≠nio Parque Lins de Vasconcelos</title>
  <style>
    :root{
      --verde-escuro:#1B3A2D;
      --verde-medio:#2E6B4F;
      --verde-claro:#A3D9B1;
      --branco:#fff;
      --bg:#F9FAFB;
      --texto:#1F2937;
    }
    *{box-sizing:border-box;margin:0;padding:0}
    html {scroll-behavior:smooth;}
    body{
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      background:var(--bg);
      color:var(--texto);
      line-height:1.5;
    }
    header{background:var(--branco);box-shadow:0 4px 12px rgba(0,0,0,0.06);z-index:999;}
    .header-content{max-width:1200px;margin:0 auto;padding:12px 20px;display:flex;align-items:center;justify-content:space-between;gap:12px;}
    .logo-row{display:flex;align-items:center;gap:16px;}
    .logo-row img{height:78px;width:auto;border-radius:10px;transition:transform .2s;box-shadow:0 6px 16px rgba(0,0,0,0.12);}
    .logo-row h1{font-size:1.8rem;color:var(--verde-escuro);font-weight:800;letter-spacing:0.01em;}
    .nav {display:flex;align-items:center;gap:12px;}
    .nav ul{display:flex;gap:18px;list-style:none;align-items:center;}
    .nav a{text-decoration:none;color:var(--verde-escuro);font-weight:700;padding:10px 16px;border-radius:10px;transition:background .18s, color .18s;}
    .nav a:hover{background:rgba(46,107,79,0.08)}
    .nav-toggle{display:none;background:transparent;border:0;cursor:pointer;width:44px;height:44px;}
    .nav-toggle .bar{display:block;height:3px;background:var(--verde-escuro);margin:6px 0;border-radius:3px;transition:transform .2s,opacity .2s;}
    .hero{max-width:1200px;margin:20px auto;padding:36px;border-radius:12px;color:var(--branco);background:linear-gradient(135deg,var(--verde-medio) 0%,var(--verde-claro) 100%);box-shadow:0 10px 30px rgba(0,0,0,0.12);}
    .hero h2{font-size:2.6rem;margin-bottom:12px;text-shadow:2px 2px 8px rgba(0,0,0,0.18);}
    .hero p{font-size:1.05rem;max-width:920px;margin:0 auto;font-weight:600}
    main{max-width:1200px;margin:16px auto;padding:0 20px 60px}
    section{background:var(--branco);margin-bottom:18px;padding:18px;border-radius:10px;box-shadow:0 6px 18px rgba(0,0,0,0.06);}
    section h2{color:var(--verde-escuro);font-size:1.5rem;margin-bottom:8px;font-weight:800;display:flex;align-items:center;gap:12px;}
    .cards{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:14px;margin-top:12px;}
    .card{background:#FAFCFB;padding:14px;border-radius:10px;border-left:6px solid var(--verde-medio);}
    .card h3{margin-bottom:6px;color: rgba(27,58,45,0.92); font-size:1.08rem; font-weight:700;} /* ajustado conforme pedido */
    .card .date{color:var(--verde-medio);font-weight:700;font-size:.95rem}
    .contact-form{max-width:600px;margin:0 auto}
    .form-group{margin-bottom:12px}
    label{display:block;margin-bottom:6px;font-weight:700;color:var(--verde-escuro)}
    input,textarea{width:100%;padding:10px;border:1px solid #E4E7EB;border-radius:8px;font-size:1rem}
    .btn{background:var(--verde-medio);color:var(--branco);padding:10px 18px;border-radius:10px;border:0;font-weight:800;cursor:pointer}
    .btn-small{padding:6px 10px;font-size:0.9rem;border-radius:8px}
    footer{background:var(--verde-escuro);color:var(--branco);text-align:center;padding:20px;font-weight:600;margin-top:20px;border-radius:6px}
    @media (max-width: 880px){.logo-row img{height:64px}.logo-row h1{font-size:1.2rem}.hero{padding:24px}.hero h2{font-size:1.6rem}.hero p{font-size:0.98rem}.nav ul{display:none}.nav-toggle{display:block}header{position:static}}
    .nav.open ul{display:block;position:absolute;right:20px;top:84px;background:var(--branco);border-radius:10px;padding:8px;box-shadow:0 10px 30px rgba(0,0,0,0.12);min-width:180px;}
    @media (min-width:881px){html {scroll-padding-top:120px;}header{position:sticky; top:0;}}
    /* ocultar √°rea de publica√ß√£o j√° que voc√™ n√£o quer mais usar */
    #publish-btn, #login-btn, #login-placeholder, #cms-toggle-btn, #cms-drawer { display: none !important; }
  </style>
</head>
<body>
  <header>
    <div class="header-content">
      <div class="logo-row">
        <img src="https://cdn.abacus.ai/images/ca8ad4ba-c6b4-45a6-b78e-fafb406f6229.png" alt="Logo Condom√≠nio">
        <h1>Condom√≠nio Parque Lins de Vasconcelos</h1>
      </div>

      <nav class="nav" id="site-nav">
        <button class="nav-toggle" id="navToggle" aria-label="Abrir menu">
          <span class="bar"></span><span class="bar"></span><span class="bar"></span>
        </button>
        <ul>
          <li><a href="#inicio">In√≠cio</a></li>
          <li><a href="#avisos">Avisos</a></li>
          <li><a href="#bazar">Bazar</a></li>
          <li><a href="#prestadores">Prestadores</a></li>
          <li><a href="#eventos">Eventos</a></li>
          <li><a href="#regras">Regras</a></li>
          <li><a href="#contato">Contato</a></li>
        </ul>
      </nav>
    </div>
  </header>

  <main>
    <section id="inicio" class="hero" aria-labelledby="titulo-hero">
      <h2 id="titulo-hero">Bem-vindo ao Portal do Condom√≠nio</h2>
      <p>Seu espa√ßo de comunica√ß√£o, informa√ß√£o e conviv√™ncia. Aqui voc√™ encontra avisos importantes, eventos, servi√ßos e muito mais!</p>
    </section>

    <section id="avisos">
      <h2>üì¢ Avisos e Comunicados</h2>
      <div style="text-align:right; margin-bottom:12px;">
        <!-- √°rea de publica√ß√£o oculta -->
        <a id="publish-btn" class="btn" href="/admin" target="_blank" rel="noopener noreferrer" style="display:none;">Publicar Aviso</a>
        <button id="login-btn" class="btn" style="margin-left:10px; background:#fff; color:var(--verde-medio); border:2px solid var(--verde-medio); display:none;">Entrar</button>
        <span id="login-placeholder" style="display:none; margin-left:12px; color:var(--verde-medio); font-weight:700;">√Årea de publica√ß√£o dispon√≠vel apenas para administradores.</span>
      </div>
      <div class="cards">
        <p>Carregando avisos...</p>
      </div>
    </section>

    <section id="bazar">
      <h2>üõçÔ∏è Bazar e Doa√ß√µes</h2>
      <div class="cards">
        <p>Carregando...</p>
      </div>
    </section>

    <section id="prestadores">
      <h2>üîß Prestadores de Servi√ßo</h2>
      <div class="cards">
        <p>Carregando...</p>
      </div>
    </section>

    <section id="eventos">
      <h2>üéâ Eventos</h2>
      <div class="cards">
        <p>Carregando...</p>
      </div>
    </section>

    <section id="regras">
      <h2>üìã Regras do Condom√≠nio</h2>
      <div class="cards">
        <p>Carregando...</p>
      </div>
    </section>

    <section id="contato">
      <h2>üìû Contato e S√≠ndico</h2>
      <div class="contact-form">
        <p style="text-align:center; margin-bottom:12px;"><strong>S√≠ndico:</strong> Jos√© Carlos Oliveira<br><strong>Telefone:</strong> (21) 99999-0000</p>
        <form onsubmit="event.preventDefault(); alert('Este √© um exemplo ‚Äî em um site real a mensagem seria enviada.');">
          <div class="form-group"><label for="nome">Nome</label><input id="nome"></div>
          <div class="form-group"><label for="apt">Apartamento</label><input id="apt" placeholder="Ex: 201 - Bloco A"></div>
          <div class="form-group"><label for="mensagem">Mensagem</label><textarea id="mensagem" rows="4"></textarea></div>
          <div style="text-align:center"><button class="btn" type="submit">Enviar Mensagem</button></div>
        </form>
      </div>
    </section>
  </main>

  <footer>
    <p><strong>Condom√≠nio Residencial Parque Lins de Vasconcelos</strong></p>
    <p>¬© 2025 - Todos os direitos reservados</p>
  </footer>

  <!-- biblioteca para markdown -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <!-- netlify identity (inativo/oculto, mantido por compatibilidade caso queira voltar) -->
  <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>

  <script>
    // Config do reposit√≥rio
    const OWNER = 'parquelins';
    const REPO  = 'meuparquelins';
    const BRANCH = 'main';

    // helpers
    function escapeRegExp(s) { return (s || '').replace(/[.*+?^${}()|[\\\]\\]/g, '\\$&'); }

    // parse frontmatter: aceita ---...--- e tamb√©m bloco chave: valor no topo sem ---
    function parseFrontmatter(md) {
      if (!md) return { data: {}, body: '' };
      md = md.replace(/^\uFEFF/, ''); // remove BOM se houver

      // padr√£o com --- ... ---
      const fmDash = /^---\s*[\r\n]+([\s\S]*?)\r?\n---\s*[\r\n]*(.*)$/;
      let m = md.match(fmDash);
      if (m) {
        const lines = m[1].split(/\r?\n/);
        const data = {};
        for (const line of lines) {
          const idx = line.indexOf(':');
          if (idx === -1) continue;
          const k = line.slice(0, idx).trim();
          let v = line.slice(idx + 1).trim();
          if (/^"(.*)"$/.test(v) || /^'(.*)'$/.test(v)) v = v.slice(1, -1);
          data[k] = v;
        }
        return { data, body: m[2] || '' };
      }

      // fallback: linhas iniciais chave: valor (at√© linha em branco ou at√© encontrar linha n√£o-KV)
      const lines = md.split(/\r?\n/);
      const data = {};
      let i = 0;
      let sawKV = false;
      for (; i < lines.length; i++) {
        const line = lines[i].trim();
        if (line === '') { i++; break; }
        if (/^[A-Za-z0-9_\-]+:\s*.*$/.test(line)) {
          sawKV = true;
          const idx = line.indexOf(':');
          const k = line.slice(0, idx).trim();
          let v = line.slice(idx + 1).trim();
          if (/^"(.*)"$/.test(v) || /^'(.*)'$/.test(v)) v = v.slice(1, -1);
          data[k] = v;
        } else {
          sawKV = false;
          break;
        }
      }
      if (sawKV) {
        const body = lines.slice(i).join('\n');
        return { data, body };
      }

      // nada: retorna inteiro como body
      return { data: {}, body: md };
    }

    // lista arquivos markdown em um path da repo via GitHub API
    async function listaCollection(collectionPath){
      const api = `https://api.github.com/repos/${OWNER}/${REPO}/contents/${collectionPath}?ref=${BRANCH}`;
      try {
        const res = await fetch(api);
        if (!res.ok) return [];
        const data = await res.json();
        return data.filter(item => item.name.endsWith('.md')).sort((a,b)=> b.name.localeCompare(a.name));
      } catch(e) { console.error('Erro listaCollection', e); return []; }
    }

    async function buscaMarkdown(download_url){
      try {
        const res = await fetch(download_url);
        if (!res.ok) return '';
        return await res.text();
      } catch(e) { console.error('Erro fetch md', e); return ''; }
    }

    // renderiza m√≠dias (image, youtube, vimeo, mp4)
    function renderMedia(front){
      let html = '';
      // imagens via frontmatter
      if (front.data && front.data.image) {
        const imgs = Array.isArray(front.data.image) ? front.data.image : [front.data.image];
        imgs.forEach(src => {
          if (!src) return;
          html += `<img src="${src}" alt="" style="max-width:100%;margin-bottom:10px;border-radius:8px;box-shadow:0 6px 18px rgba(0,0,0,0.06);" />`;
        });
      } else {
        // procurar uploads dentro do body
        const matches = (front.body && front.body.match(/\/uploads\/[^\s)"]+/g)) || [];
        matches.forEach(m => {
          html += `<img src="${m}" style="max-width:100%;margin-bottom:10px;border-radius:8px;" />`;
        });
      }

      const videoUrl = front.data && (front.data.video_url || front.data.video) ? (front.data.video_url || front.data.video).trim() : '';
      if (videoUrl) {
        const yt = videoUrl.match(/(?:youtube\.com\/watch\?v=|youtu\.be\/)([A-Za-z0-9_-]+)/);
        if (yt && yt[1]) {
          html += `<div style="margin-top:12px"><iframe src="https://www.youtube.com/embed/${yt[1]}" style="width:100%;max-width:900px;height:400px;border-radius:8px;" frameborder="0" allowfullscreen></iframe></div>`;
        } else {
          const vm = videoUrl.match(/vimeo\.com\/(\d+)/);
          if (vm && vm[1]) {
            html += `<div style="margin-top:12px"><iframe src="https://player.vimeo.com/video/${vm[1]}" style="width:100%;max-width:900px;height:400px;border-radius:8px;" frameborder="0" allowfullscreen></iframe></div>`;
          } else {
            // mp4 player
            html += `
              <div style="margin-top:12px;max-width:900px;">
                <video controls preload="none" style="width:100%;height:auto;background:#000;border-radius:6px;">
                  <source src="${videoUrl}" type="video/mp4">
                  Seu navegador n√£o suporta v√≠deo.
                </video>
              </div>`;
          }
        }
      }

      return html;
    }

    // resumo: primeiras 3 linhas n√£o vazias do body
    function resumoDasPrimeirasLinhas(body, maxLines = 3) {
      if (!body) return '';
      const lines = body.split(/\r?\n/).map(l => l.trim()).filter(l => l.length);
      return lines.slice(0, maxLines).join(' ') + (lines.length > maxLines ? '...' : '');
    }

    // carrega uma collection e injeta cards na se√ß√£o
    async function carregarCollection(collectionPath, sectionSelector) {
      const container = document.querySelector(sectionSelector + ' .cards');
      if (!container) return;
      container.innerHTML = '<p>Carregando...</p>';
      try {
        const files = await listaCollection(collectionPath);
        if (!files.length) { container.innerHTML = '<p>Nenhum item encontrado.</p>'; return; }
        container.innerHTML = '';
        for (const file of files) {
          const md = await buscaMarkdown(file.download_url);
          const parsed = parseFrontmatter(md);
          const title = parsed.data.title || file.name.replace('.md','');
          const date  = parsed.data.date || parsed.data.data || '';
          const summary = parsed.data.summary || resumoDasPrimeirasLinhas(parsed.body, 3) || (parsed.body ? parsed.body.substring(0,160) + '...' : '');
          const card = document.createElement('div');
          card.className = 'card';
          card.innerHTML = `<span class="date">${date}</span><h3>${title}</h3><p>${summary}</p>
            <p style="margin-top:8px"><a href="#" data-file="${file.download_url}" class="btn btn-small">Ver aviso</a></p>`;
          container.appendChild(card);
        }

        // listeners para abrir modal (cada se√ß√£o tem seus bot√µes)
        container.querySelectorAll('a[data-file]').forEach(a => {
          a.addEventListener('click', async (e) => {
            e.preventDefault();
            const dl = e.currentTarget.getAttribute('data-file');
            const md = await buscaMarkdown(dl);
            const parsed = parseFrontmatter(md);

            // remover links/nome do arquivo de v√≠deo do corpo (se houver)
            const videoUrl = parsed.data && (parsed.data.video || parsed.data.video_url) ? (parsed.data.video || parsed.data.video_url).trim() : '';
            if (videoUrl && parsed.body) {
              const filename = videoUrl.split('/').pop();
              const reExact = new RegExp('\\[[^\\]]*\\]\\(\\s*' + escapeRegExp(videoUrl) + '\\s*\\)', 'g');
              parsed.body = parsed.body.replace(reExact, '');
              const reFile = new RegExp('\\[[^\\]]*\\]\\([^)]*' + escapeRegExp(filename) + '[^)]*\\)', 'g');
              parsed.body = parsed.body.replace(reFile, '');
              parsed.body = parsed.body.replace(new RegExp(escapeRegExp(videoUrl), 'g'), '');
              parsed.body = parsed.body.replace(new RegExp(escapeRegExp(filename), 'g'), '');
            }

            // convert markdown to html
            let html = marked.parse(parsed.body || '');

            // remove qualquer player HTML vindo do MD (evita duplica√ß√£o)
            html = html.replace(/<video[\s\S]*?<\/video>/gi, '');
            html = html.replace(/<iframe[\s\S]*?<\/iframe>/gi, '');

            // monta modal
            const modal = document.createElement('div');
            modal.style = 'position:fixed;left:0;top:0;width:100%;height:100%;overflow:auto;background:rgba(0,0,0,0.6);padding:30px;z-index:9999;';
            modal.innerHTML = `<div style="max-width:900px;margin:0 auto;background:#fff;padding:22px;border-radius:10px;position:relative;">
              <button id="fechar" style="position:absolute;right:14px;top:14px;padding:8px 12px;border-radius:8px;border:0;cursor:pointer;">Fechar</button>
              <h2 style="color:${'var(--verde-escuro)'};margin:0">${parsed.data.title || ''}</h2>
              <p style="color:${'var(--verde-medio)'};font-weight:700;margin:6px 0 12px 0">${parsed.data.date || ''}</p>
              <div style="margin-top:12px">${renderMedia(parsed)}${html}</div>
            </div>`;
            document.body.appendChild(modal);
            modal.querySelector('#fechar').addEventListener('click', ()=> modal.remove());
          });
        });

      } catch(err) {
        console.error('Erro carregarCollection', err);
        container.innerHTML = '<p>Erro ao carregar itens.</p>';
      }
    }

    // inicializa√ß√£o: carrega todas as collections
    document.addEventListener('DOMContentLoaded', () => {
      carregarCollection('content/avisos', '#avisos');
      carregarCollection('content/bazar', '#bazar');
      carregarCollection('content/prestadores', '#prestadores');
      carregarCollection('content/eventos', '#eventos');
      carregarCollection('content/regras', '#regras');

      // nav mobile toggle
      const nav = document.getElementById('site-nav');
      const toggle = document.getElementById('navToggle');
      toggle && toggle.addEventListener('click', () => nav.classList.toggle('open'));
      document.querySelectorAll('.nav ul a').forEach(a => a.addEventListener('click', () => nav.classList.remove('open')));
    });
  </script>

</body>
</html>
